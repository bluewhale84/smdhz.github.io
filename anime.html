<!DOCTYPE html>

<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>法布雷大叔</title>

    <script src="http://cdn.bootcss.com/jquery/2.2.0/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <script src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.11/js/dataTables.bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.11/css/dataTables.bootstrap.min.css">
</head>
<body>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="Index.html">My life for Aiur</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="Index.html">主页</a></li>
                    <li><a href="Faith.html">信仰</a></li>
                     <li role="presentation" class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">项目 <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="Projects/WTD.html">What to develop</a></li>
                            <li><a href="Projects/CodeA.html">CodeA</a></li>
                        </ul>
                    </li>
                    <li class="active"><a href="Anime.html">动画</a></li>
                    <li><a href="Me.html">关于</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="jumbotron">
            <p>
                <span class="glyphicon glyphicon-list" aria-hidden="true"></span>
                <span>此页内容来自服务器传递的动画信息</span>
            </p>
            <p><small><s>萌不到站长的动画是不会出现在列表里的</s></small></p>
        </div>
        <table id="content" class="table table-striped">
            <thead>
                <tr>
                    <th>标题</th>
                    <th>周</th>
                    <th>集</th>
                </tr>
            </thead>
        </table>
        <form style="margin-bottom: 10px">
            <button type="button" class="btn btn-primary" disabled="disabled" onclick="lookfor()">查找</button>
        </form>
    </div>

    <script>
        var table = $("#content").dataTable({
            "order": [[1, "asc"]],
            "bFilter": false,
            "bInfo": false,
            "bPaginate": false
        });
        var weekdays = ["星期日（日曜日）", "星期一（月曜日）", "星期二（火曜日）", "星期三（水曜日）", "星期四（木曜日）", "星期五（金曜日）", "星期六（土曜日）"];
        var keyword = null;

        $.ajax({
            url: "Files/Anime.xml",
            type: "GET",
            success: function (response) {
                $(response).find("AnimeInfo").each(function (index, anime) {
                    var array = [];

                    var time = new Date($(anime).find("First").text());
                    var weeks = Math.ceil((new Date() - time) / (7 * 24 * 3600 * 1000));

                    array.push($(anime).find("Title").text());
                    array.push(weekdays[$(anime).find("Weekday").text()]);
                    array.push(weeks);
                    array.push($(anime).find("Keyword").text());

                    table.fnAddData(array);
                });
            }
        });

        $("#content tbody").on("click", "tr", function () {
            $("#content tbody .info").removeClass("info");
            $(this).addClass("info");

            keyword = $("#content").DataTable().rows(this).data()[0][3];
            $(".btn-primary").removeAttr("disabled");
        });

        function lookfor() {
            window.open("https://share.dmhy.org/topics/list?keyword=" + keyword);
        }
    </script>
</body>
</html>